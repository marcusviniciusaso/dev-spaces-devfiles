schemaVersion: 2.2.0
metadata:
  name: custom-base-udi
  displayName: "Custom Base UDI(Dev Spaces 3.22)"
  description: "Container com tools baseado na UDI com az/kubectl/helm/oc/cekit/kind/podman..."
  version: 1.0.2
  tags: ["openshift", "kubernetes", "helm", "podman", "azure"]
attributes:
  pod-overrides:
    metadata:
      annotations:
        io.kubernetes.cri-o.Devices: "/dev/fuse,/dev/net/tun"
components:
  - name: tools
    container:
      image: quay.io/marolive/custom-udi:1.0.1
      mountSources: true
      sourceMapping: /projects
      command: ["bash", "-lc", "sleep infinity"]
      memoryLimit: 4Gi
      cpuLimit: "2"
      env:
        - name: KUBEDOCK_PARAMS
          value: "--reverse-proxy --kubeconfig /home/user/.kube/config --initimage quay.io/agiertli/kubedock:0.13.0"
        - name: KUBEDOCK_ENABLED
          value: 'true'
        - name: DOCKER_HOST
          value: 'tcp://127.0.0.1:2475'
        - name: TESTCONTAINERS_RYUK_DISABLED
          value: 'true'
        - name: TESTCONTAINERS_CHECKS_DISABLE
          value: 'true'
      endpoints:
        - exposure: none
          name: kubedock
          protocol: tcp
          targetPort: 2475
commands:
  - id: verify
    exec:
      component: tools
      commandLine: |
        set -euo pipefail
        echo "== /etc/devspaces-linux-release ==" && cat /etc/devspaces-linux-release
        echo "== oc/kubectl/helm/az/podman ==" 
        oc version --client
        kubectl version --client
        helm version
        az version | head -n 30
        podman version
      workingDir: /projects
      group:
        kind: run
        isDefault: true
events:
  postStart:
    - verify
